d3.starPlot=function(){var l,d,e=200,_={top:0,right:0,bottom:0,left:0},u=20,r=!0,c=!0,h=[],y=[],i=t,o=t,g=e/2,p=[g,g],a=h.length,m=2*Math.PI/a,f=d3.scale.linear().domain([0,100]).range([0,g]);function n(t){var a,n;d=t.datum(),l=t.attr("transform","translate("+_.left+","+_.top+")"),r&&(a=0,h.forEach(function(t,e){var r=g;radar_x=r*Math.cos(a),radar_y=r*Math.sin(a),l.append("line").attr("class","star-axis").attr("x1",p[0]).attr("y1",p[1]).attr("x2",p[0]+radar_x).attr("y2",p[1]+radar_y),a+=m})),function(){l.append("circle").attr("class","star-origin").attr("cx",p[0]).attr("cy",p[1]).attr("r",2);var t=d3.svg.line.radial(),r=[],a=Math.PI/2;h.forEach(function(t,e){e=y[e]||y[0];r.push([e(d[t]),a]),a+=m}),console.log(f(y[0](2))),l.append("path").attr("class","star-path").attr("transform","translate("+p[0]+","+p[1]+")").attr("d",t(r)+"Z"),l.append("text").attr("class","star-title").attr("x",p[0]).attr("y",-_.top/2).text(o(d)).style("text-anchor","middle")}(),c&&(n=0,h.forEach(function(t,e){var r=g;radar_x=(r+u)*Math.cos(n),radar_y=(r+u)*Math.sin(n),l.append("text").attr("class","star-label").attr("x",p[0]+radar_x).attr("y",p[1]+radar_y).text("function"==typeof i?i(d,e):i[e]).style("text-anchor","middle").style("dominant-baseline","central"),n+=m}))}function t(){}return n.interaction=function(){var i,o,s;i=d3.svg.line.radial(),o=Math.PI/2,s=0,h.forEach(function(t,e){var r=g,a=(Math.cos(o),Math.sin(o),g+u),n=a*Math.cos(s)+p[0]+_.left,c=a*Math.sin(s)+p[1]+_.top,a=y[e]||y[0];lValue=f(a(d[t])),radar_x=lValue*Math.cos(s)+p[0]+_.left,radar_y=lValue*Math.sin(s)+p[1]+_.top;t=m/2,t=[[0,o-t],[r,o-t],[r,o+t]],e={xExtent:n,yExtent:c,x:radar_x,y:radar_y,key:h[e],datum:d};l.append("path").datum(e).attr("class","star-interaction").attr("transform","translate("+p[0]+","+p[1]+")").attr("d",i(t)+"Z"),o+=m,s+=m})},n.properties=function(t){return arguments.length?(a=(h=t).length,m=2*Math.PI/a,n):h},n.scales=function(t){return arguments.length?(y=Array.isArray(t)?t:[t],n):y},n.width=function(t){return arguments.length?(p=[g=(e=t)/2,g],f.range([0,g]),n):e},n.margin=function(t){return arguments.length?(_=t,p=[g,g],n):_},n.labelMargin=function(t){return arguments.length?(u=t,n):u},n.title=function(t){return arguments.length?(o=t,n):o},n.labels=function(t){return arguments.length?(i=t,n):i},n.includeGuidelines=function(t){return arguments.length?(r=t,n):r},n.includeLabels=function(t){return arguments.length?(c=t,n):c},n};var margin_right,margin_left,margin_top,margin_bottom,margins,row_chart_width,row_chart_height,format,row_chart_x,row_chart_y,row_chart_xAxis,row_chart_yAxis,row_chart_svg,row_chart_svg_width,legend_padding,stacked_chart_svg_width,stacked_chart_svg_height,stacked_chart_width,stacked_chart_height,rank_text_group,svg,g,key_story_g,y,x,z,key_story_01_x,key_story_02_x,tooltip,radar_margin={top:90,right:100,bottom:20,left:100},radar_width=$("#radarChart").width()-radar_margin.left-radar_margin.right,radar_height=radar_width,labelMargin=20;function draw_radar_chart(a){d3.csv("data/baseline.csv",function(t){d3.csv("data/DMA Compiled - RC_v1.csv").get(function(t,e){d3.selectAll(".radar_chart").remove(),console.log(e),console.log(a),e=e.filter(function(t){if(t.Country===a&&t.Year===year)return t}),console.log(e);var r=d3.scale.linear().domain([-2,2]).range([0,radar_width/2]);console.log(radar_width/2),console.log(r(2));var d=d3.starPlot().width(radar_width).properties(["X Z-score Domestic interest","Y Z-score Country engagement","X Z-score Solidarity","Y Z-score Global engagement"]).scales(r).labels(["SELF INTEREST","COUNTRY ENGAGEMENT","ALTRUISM","GLOBAL ENGAGEMENT"]).title(function(t){return""}).margin(radar_margin).labelMargin(labelMargin);e.forEach(function(t,e){var r=d3.select("#radarChart"),a=r.append("svg").attr("class","radar_chart").attr("width",radar_width+radar_margin.left+radar_margin.right).attr("height",radar_width+radar_margin.left+radar_margin.right),n=a.append("g").datum(t).call(d).call(d.interaction),c=(r.append("div").attr("class","interaction label"),d.properties()),i=c.length;grid_group=n.append("g").attr("class","gridGroup");for(var o=0;o<8;o++){var s=radar_width/2*1*((o+1)/8);console.log(s),grid_group.selectAll(".levels").data(c).enter().append("svg:line").attr("x1",function(t,e){return s*(1-+Math.sin(e*(2*Math.PI)/i))}).attr("y1",function(t,e){return s*(1-+Math.cos(e*(2*Math.PI)/i))}).attr("x2",function(t,e){return s*(1-+Math.sin((e+1)*(2*Math.PI)/i))}).attr("y2",function(t,e){return s*(1-+Math.cos((e+1)*(2*Math.PI)/i))}).attr("class","line").style("stroke",function(){return 0===o?"black":"#282828"}).style("stroke-opacity","0.75").style("stroke-width",function(){return 3===o?"2px":"0.3px"}).style("fill",function(){return 0===o?"black":"transparent"}).attr("class","grid_line").attr("transform","translate("+(radar_width/2-s)+", "+(radar_width/2-s)+")")}for(var l=-1.5,o=0;o<8;o++){s=radar_width/2*1*((o+1)/8);this_break_point=.5*o,console.log(l),n.selectAll(".levels").data([1]).enter().append("svg:text").attr("x",function(t){return s*(1-+Math.sin(0))}).attr("y",function(t){return s*(1-+Math.cos(0))}).attr("class","legend").style("font-family","HelveticaNeue-Bold").attr("transform","translate("+(radar_width/2-s+5)+", "+(radar_width/2-s)+")").attr("fill","#000").text(l),l+=.5}a.append("circle").attr("class","interaction circle").attr("r",5).attr("fill","red"),r.selectAll(".interaction").style("display","none");a.selectAll(".star-interaction")})})})}function create_rowChart(t){row_chart_margins=[margin_top=margin_right=5,margin_right,margin_bottom=0,margin_left=95],row_chart_svg_width=$("#"+t).width(),row_chart_width=$("#"+t).width()-margin_left-margin_right,row_chart_height=370-margin_top-margin_bottom,format=d3.format(",.0f"),row_chart_x=d3.scaleLinear().range([0,row_chart_width]),row_chart_y=d3.scaleBand().range([0,row_chart_height]).padding(.1),row_chart_xAxis=d3.axisTop(row_chart_x),row_chart_yAxis=d3.axisLeft(row_chart_y),row_chart_svg=d3.select("#"+t).append("svg").attr("class","svg"+t).attr("width",row_chart_svg_width).attr("height",row_chart_height+margin_top+margin_bottom),row_chart_g=row_chart_svg.append("g").attr("class","g"+t).attr("transform","translate("+margin_left+","+margin_top+")"),d3.selectAll(".svg"+t).append("g").attr("class","y axis").attr("transform","translate("+margin_left+", 0)").attr("class","yAxis"+t)}function draw_rowChart(t,e,r,a,n,c){var i=t.filter(function(t){return t.Year==c});minValue=d3.min(i,function(t){return+t[r]}),i.forEach(function(t){t[r]=+t[r]}),i.sort(function(t,e){return e[r]-t[r]}),row_chart_x.domain([0,d3.max(i,function(t){return t[r]})]),row_chart_y.domain(i.map(function(t){return t.Country})),d3.selectAll(".yAxis"+e).call(row_chart_yAxis).selectAll("text").attr("id",function(t){return"bar_chart_label"+t.replace(" ","")}).attr("class",function(t){return"bar_chart_test"});e=d3.select(".g"+e).selectAll("rect").data(i);e.enter().append("rect").attr("class","bar").attr("transform",function(t){return"translate(0,"+(row_chart_y(t.Country)-row_chart_y.bandwidth()/2)+")"}).attr("width",function(t){return row_chart_x(t[r])}).attr("fill",a).attr("height",row_chart_y.bandwidth()).attr("id",function(t){return"bar_chart_rect"+t.Country.replace(" ","")}).attr("class","bar_chart_rect"),e.attr("width",function(t){return row_chart_x(t[r])}).attr("transform",function(t){return"translate(0,"+(row_chart_y(t.Country)-row_chart_y.bandwidth()/2)+")"}).attr("height",row_chart_y.bandwidth()).attr("id",function(t){return"bar_chart_rect"+t.Country.replace(" ","")}),e.exit().remove(),resize_row_chart=function(t,e){updated_row_chart_svg_width=$("#"+t).width(),updated_row_chart_width=$("#"+t).width()-margin_left-margin_right,d3.select("#"+t).select("svg").attr("width",updated_row_chart_svg_width),row_chart_x.range([0,updated_row_chart_width]).domain([0,d3.max(i,function(t){return t[e]})]),d3.select(".g"+t).selectAll(".bar_chart_rect").attr("width",function(t){return row_chart_x(t[e])})}}function updateBarChart(t){d3.selectAll(".bar_chart_rect").style("opacity",.3),d3.selectAll(".bar_chart_test").style("opacity",.3),d3.selectAll("#bar_chart_rect"+t.replace(" ","")).style("opacity","1"),d3.selectAll("#bar_chart_label"+t.replace(" ","")).style("opacity","1")}var yAxis,gy,columns,bar_chart_drawn=!1;function create_stacked_chart(t,e){mobile=600,screen_width=window.innerWidth;margin=screen_width<mobile?{top:0,right:6,bottom:0,left:155}:{top:0,right:6,bottom:0,left:200},stacked_chart_svg_width=document.getElementById(e).clientWidth-15,stacked_chart_svg_height=500,stacked_chart_width=stacked_chart_svg_width-margin.left-margin.right,stacked_chart_height=stacked_chart_svg_height-margin.top-margin.bottom,svg=d3.select("#"+e).append("svg").attr("width",stacked_chart_svg_width).attr("height",stacked_chart_svg_height),g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),key_story_g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),y=d3.scaleBand().rangeRound([0,stacked_chart_height]).paddingInner(.05).align(.1),x=d3.scaleLinear().rangeRound([0,stacked_chart_width]),key_story_01_x=d3.scaleLinear().rangeRound([0,stacked_chart_width]),key_story_02_x=d3.scaleLinear().rangeRound([0,stacked_chart_width]),z=d3.scaleOrdinal().range(["#796d94","#3ebfb9","#3282bf","#027f71"]),tooltip=d3.select("body").append("div").attr("class","toolTip"),rank_text_group=g.append("g").attr("transform","translate("+-margin.left+",0)").attr("class","rank_text_group"),yAxis=d3.axisLeft().scale(y).tickSize(10),gy=g.append("g").attr("class","y axis")}function draw_stacked_chart(e,r){function a(t){aid_quantity_checkbox.checked?(d3.selectAll(".countryProfileBarChartsYearToggle").style("display","block"),d3.selectAll(".countryRect").transition().style("opacity",0),update_country_text("global"),reset_sidebar()):(d3.selectAll("#aboutsidebarText").html(""),d3.selectAll(".countryProfileBarChartsYearToggle").style("display","block"),active_year=d3.select(".year_switch.active").html(),updateBarChart(t.data.Country),update_country_text(t.data.Country),draw_sidebar_stats(t.data,active_year),d3.selectAll(".countryRect").transition().style("opacity",.5),d3.selectAll("#"+t.data.Country.replace(/\s+/g,"-")).transition().style("opacity",1)),console.log("inactive"),console.log($(".sidebarContent").height()),console.log("changing body height"),$("body").css("min-height",$(".sidebarContent").height()),pym.sendHeight()}d3.csv(e,function(e,r){for(r=1,t=0;r<columns.length;++r)t+=e[columns[r]]=+e[columns[r]];return e.total=t,e},function(t,e){if(t)throw t;e.forEach(function(t){t["sum of ranks string"]=String(t["sum of ranks"])}),d3.selectAll(".countryRect").remove(),d3.selectAll(".countryRectText").remove(),d3.selectAll(".key_story_hover_text").html(""),e=e.filter(function(t){if(t.Year===current_year)return t});t=columns.slice(1);e.sort(function(t,e){return e["sum of ranks"]-t["sum of ranks"]}),y.domain(e.map(function(t){return t.Country})),x.domain([0,d3.max(e,function(t){return t.total})]),key_story_01_x.domain([0,d3.max(e,function(t){return t["Story 1"]})]),key_story_02_x.domain([0,d3.max(e,function(t){return t["Story 2"]})]),key_story_02_x.domain([-.3,.5]),z.domain(["sum of ranks","Need","Global System","Public Spirited"]),gy.call(yAxis).selectAll("text").text(function(t){return!1===bar_chart_drawn?"":t}).attr("id",function(t){return"y_tick_text"+t}).on("click",function(t){var e=d3.selectAll("#"+t.replace(/\s+/g,"-")),t=d3.selectAll("#"+t.replace(/\s+/g,"-")).data();d3.selectAll(".countryRect").classed("active",!1),e.classed("active",!0),$(e).hasClass("active")?reset_sidebar():a(t[0]),pym.sendHeight()}).transition().delay(function(t,e){return 50*e}).duration(1e3).text(function(t){return t});d3.axisBottom().scale(x).tickSize(10);g.append("g").selectAll("g").data(d3.stack().keys(t)(e)).enter().append("g").attr("fill",function(t){return z(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("class","countryRect").attr("id",function(t){return t.data.Country.replace(/\s+/g,"-")}).attr("href",function(t){return t.data.Country}).attr("y",function(t){return y(t.data.Country)}).attr("x",function(t){return x(t[0])}).attr("width",function(t){return console.log(bar_chart_drawn),!1===bar_chart_drawn?0:x(t[1])-x(t[0])}).attr("height",y.bandwidth()).attr("opacity",function(){return!0===document.querySelector('input.aid_quantity[type="checkbox"]').checked?0:1}).on("click",function(t){$(this).hasClass("active")?(reset_sidebar(),console.log("active"),console.log($("body").height()),console.log($(".sidebarContent").height()),console.log("changing body height"),$("body").css("min-height",$(".sidebarContent").height()),pym.sendHeight()):(d3.selectAll(".countryRect").classed("active",!1),d3.select(this).classed("active",!0),a(t))}).transition().delay(function(t,e){return 50*e}).duration(1100).attr("width",function(t){return x(t[1])-x(t[0])}),g.append("g").selectAll("g").data(d3.stack().keys(t)(e)).enter().append("g").attr("fill",function(t){return"white"}).selectAll("text").data(function(t){return t}).enter().append("text").attr("class","countryRectText").attr("y",function(t){return y(t.data.Country)+y.bandwidth()/2}).attr("x",function(t){return x(t[1])-2}).attr("text-anchor","end").attr("dy","0.35em").attr("opacity",function(){return!0===document.querySelector('input.aid_quantity[type="checkbox"]').checked?0:1}).text(function(t){return twoDPFormat(t[1]-t[0])}),rank_GSB_circles=rank_text_group.selectAll(".rank_GSB_circles").data(e),rank_GSB_circles.enter().append("circle").attr("class","rank_GSB_circles").attr("cy",function(t){return y(t.Country)+y.bandwidth()/2+2}).attr("r",0).attr("cx",function(t){return 30}).attr("fill",function(t){return t.Rank<=10?"#8ec36e":t.Rank<=20?"#f6a245":t.Rank<=30?"#e75f51":void 0}).transition().delay(function(t,e){return 50*e}).duration(1e3).attr("r",y.bandwidth()/2+.5),rank_text=rank_text_group.selectAll(".rank_text").data(e),rank_text.enter().append("text").attr("class","rank_text").attr("y",function(t){return y(t.Country)+y.bandwidth()/2}).attr("dy","0.5em").attr("x",function(t){return console.log("text"),30}).text(function(t){return""}).attr("text-anchor","middle").transition().delay(function(t,e){return 50*e}).duration(1e3).text(function(t){return t.Rank}),rank_text.attr("y",function(t){return y(t.Country)+y.bandwidth()/2}).attr("dy","0.5em").attr("x",function(t){return console.log("text"),30}).text(function(t){return t.Rank}),key_story_g.selectAll(".key_story_axis_line").data(e).enter().append("line").attr("class","key_story_axis_line key_story_axis").attr("y1",function(t){return y(t.Country)+y.bandwidth()/2}).attr("y2",function(t){return y(t.Country)+y.bandwidth()/2}).attr("x1",function(t){return 0}).attr("x2",function(t){return stacked_chart_width}).attr("stroke-width",1).attr("stroke","black"),key_story_g.selectAll(".key_story_axis_circle").data(e).enter().append("circle").attr("class","key_story_axis_circle key_story_axis").attr("cy",function(t){return y(t.Country)+y.bandwidth()/2}).attr("cx",function(t){return 0}).attr("r",2),key_story_g.selectAll(".key_story_axis_circle_end").data(e).enter().append("circle").attr("class","key_story_axis_circle_end key_story_axis").attr("cy",function(t){return y(t.Country)+y.bandwidth()/2}).attr("cx",function(t){return stacked_chart_width}).attr("r",2);t=key_story_g.selectAll(".key_story_01_circles").data(e);t.enter().append("circle").attr("class","key_story_01_circles").attr("cy",function(t){return y(t.Country)+y.bandwidth()/2}).attr("cx",function(t){return 0}).attr("r",0).attr("id",function(t){return"circle_story_01_"+t.Country.replace(/\s+/g,"-")}).attr("fill",function(t){return t.Rank<=10?"#8ec36e":t.Rank<=20?"#f6a245":t.Rank<=30?"#e75f51":void 0}),t.on("mouseover",function(t){d3.selectAll(".key_story_01_circles").style("opacity",.5),d3.select(this).style("opacity",1);var e=d3.mouse(this);d3.selectAll(".key_story_hover_text").html("<b>"+key_story_01_value+"</b>: "+twoDPFormat(+t["Story 1"])+"<br><b>PA Index Score:</b> "+twoDPFormat(t["sum of ranks"])).style("left",e[0]+160+"px").style("top",e[1]-20+"px").style("visibility","visible")}).on("mouseout",function(){d3.selectAll(".key_story_01_circles").style("opacity",1),d3.selectAll(".key_story_hover_text").html("").style("visibility","hidden")});e=key_story_g.selectAll(".key_story_02_circles").data(e);e.enter().append("circle").attr("class","key_story_02_circles").attr("cy",function(t){return y(t.Country)+y.bandwidth()/2}).attr("cx",function(t){return 0}).attr("r",0).attr("id",function(t){return"circle_story_02_"+t.Country.replace(/\s+/g,"-")}).attr("fill",function(t){return t.Rank<=10?"#8ec36e":t.Rank<=20?"#f6a245":t.Rank<=30?"#e75f51":void 0}),e.on("mouseover",function(t){d3.selectAll(".key_story_02_circles").style("opacity",.5),d3.select(this).style("opacity",1);var e=d3.mouse(this);(""!=t["Story 2"]?d3.selectAll(".key_story_hover_text").html("<b>"+key_story_02_value+"</b>: "+twoDPFormat(+t["Story 2"])+"<br><b>PA Index Score:</b> "+twoDPFormat(t["sum of ranks"])).style("left",e[0]+160+"px").style("top",e[1]-20+"px"):d3.selectAll(".key_story_hover_text").html("<b>No Data</b>").style("left",e[0]+170+"px").style("top",e[1]+10+"px")).style("visibility","visible")}).on("mouseout",function(){d3.selectAll(".key_story_02_circles").style("opacity",1),d3.selectAll(".key_story_hover_text").html("").style("visibility","hidden")}),g.append("text").attr("transform","translate(10, 0), rotate(270)").attr("fill","#000").attr("font-weight","bold").attr("text-anchor","end"),bar_chart_drawn=!0}),resize_main_chart=function(t){updated_stacked_chart_svg_width=document.getElementById("scatterPlotDiv").clientWidth-15,updated_stacked_chart_width=updated_stacked_chart_svg_width-margin.left-margin.right,d3.select("#scatterPlotDiv").select("svg").attr("width",updated_stacked_chart_svg_width),x.rangeRound([0,updated_stacked_chart_width]),key_story_01_x.rangeRound([0,updated_stacked_chart_width]),key_story_02_x.rangeRound([0,updated_stacked_chart_width]),d3.selectAll(".countryRect").attr("x",function(t){return x(t[0])}).attr("width",function(t){return x(t[1])-x(t[0])}),d3.selectAll(".countryRectText").attr("x",function(t){return x(t[1])-2}),d3.selectAll(".rank_GSB_circles").attr("cx",function(t){return 30}),d3.selectAll(".rank_text").attr("x",function(t){return 30}),d3.selectAll(".key_story_axis_line").attr("x1",function(t){return 0}).attr("x2",function(t){return updated_stacked_chart_width}),d3.selectAll(".key_story_axis_circle").attr("cx",function(t){return 0}),d3.selectAll(".key_story_axis_circle_end").attr("cx",function(t){return updated_stacked_chart_width}),aid_quantity_checkbox.checked&&d3.selectAll(".key_story_01_circles").attr("cx",function(t){return key_story_01_x(t["Story 1"])})}}console.log("script.js loaded"),$(window).on("load",function(){$("#exampleModal").modal("show")});var update_country_text,chart_checkbox,aid_quantity_checkbox,reset_sidebar,resize_main_chart,current_year=current_year_configured,indicatorsBlock=$("#indicatorsContent"),selectedCountry="Norway",key_story_01_label="aid quantity <br> (ODA/GNI)",key_story_02_label="aid quality <br>(QuODA)",key_story_01_value="ODA/GNI",key_story_02_value="QuODA",selectedDivID="scatterPlotDiv",twoDPFormat=d3.format(".2f"),animation_playing=!1;$(function(){});var pym,dataset="data/data.csv",textDataset="data/text_v1.csv",containerDiv=".content-area";function main(t,e){d3.csv(e,function(t){t.forEach(function(t){t["sum of ranks string"]=String(t["sum of ranks"])});var e=current_year_configured;function r(){chart_checkbox.checked=!1,columns=["Country","sum of ranks"],d3.select("#legend").style("visibility","hidden").style("height","0px"),draw_stacked_chart(dataset,selectedDivID,columns),d3.selectAll(".countryRect").style("opacity",0)}function a(){d3.selectAll(".key_story_axis").style("visibility","hidden"),d3.selectAll(".key_story_axis_label_low").html(""),d3.selectAll(".key_story_axis_label_high").html("Score /30"),d3.selectAll(".key_story_02_circles").attr("r",0).attr("cx",0),d3.selectAll(".key_story_01_circles").attr("r",0).attr("cx",0)}create_rowChart("needs_row_chart"),draw_rowChart(t,"needs_row_chart","Need","#3ebfb9",selectedCountry,e),create_rowChart("global_system_row_chart"),draw_rowChart(t,"global_system_row_chart","Global System","#3282bf",selectedCountry,e),create_rowChart("public_spirited_row_chart"),draw_rowChart(t,"public_spirited_row_chart","Public Spirited","#027f71",selectedCountry,e),create_rowChart("global_row_chart"),draw_rowChart(t,"global_row_chart","sum of ranks","#796d94",selectedCountry,e),create_stacked_chart(dataset,selectedDivID),draw_stacked_chart(dataset,selectedDivID,columns=["Country","sum of ranks"]),pym.sendHeight(),(chart_checkbox=document.querySelector('input.chart_switch[type="checkbox"]')).addEventListener("change",function(){chart_checkbox.checked?(aid_quantity_checkbox.checked=!1,a(),columns=["Country","Need","Global System","Public Spirited"],d3.select("#legend").style("visibility","visible").style("height","auto"),draw_stacked_chart(dataset,selectedDivID,columns),update_country_text("global"),reset_sidebar()):(columns=["Country","sum of ranks"],d3.select("#legend").style("visibility","hidden").style("height","0px"),draw_stacked_chart(dataset,selectedDivID,columns))}),(aid_quantity_checkbox=document.querySelector('input.aid_quantity[type="checkbox"]')).addEventListener("change",function(){aid_quantity_checkbox.checked?(r(),console.log("adding global view here"),update_country_text("global"),reset_sidebar(),d3.selectAll(".key_story_axis").style("visibility","visible"),d3.selectAll(".key_story_axis_label_low").html("Low "+key_story_01_label),d3.selectAll(".key_story_axis_label_high").html("High "+key_story_01_label),d3.selectAll(".countryRect").style("opacity",0),d3.selectAll(".key_story_02_circles").attr("r",0).attr("cx",0),d3.selectAll(".key_story_01_circles").attr("r",6).transition().duration(500).attr("cx",function(t){return key_story_01_x(t["Story 1"])})):($(this).removeClass("active"),d3.selectAll(".key_story_axis").style("visibility","hidden"),d3.selectAll(".countryRect").style("opacity",1),d3.selectAll(".countryRectText").style("opacity",1),d3.selectAll(".key_story_01_circles").attr("r",0).attr("cx",0),d3.selectAll(".key_story_axis_label_low").html(""),d3.selectAll(".key_story_axis_label_high").html("Score /30"))}),reset_sidebar=function(){aid_quantity_checkbox.checked?d3.selectAll(".countryRect").transition().style("opacity",0):d3.selectAll(".countryRect").transition().style("opacity",1),d3.selectAll(".countryRect").classed("active",!1),d3.selectAll(".countryProfileBarChartsYearToggle").style("display","none"),d3.selectAll(".bar_chart_rect").style("opacity",1),d3.selectAll(".bar_chart_test").style("opacity",1),update_country_text("global"),d3.selectAll("#score_text").html(""),d3.selectAll("#rank_text").html(""),d3.selectAll("#position_change_text").html("")},d3.selectAll("#refresh_button").on("click",function(){draw_stacked_chart(dataset,selectedDivID,columns=["Country","sum of ranks"]),update_country_text("global"),reset_sidebar(),aid_quantity_checkbox.checked=!1,chart_checkbox.checked=!1,a(),r()}),d3.selectAll(".year_switch").on("click",function(){d3.selectAll(".year_switch").classed("active",!1),$(this).addClass("active"),updated_current_year=d3.select(this).html(),d3.selectAll("#current_year_span").html(updated_current_year),draw_rowChart(t,"needs_row_chart","Need","#3ebfb9",selectedCountry,updated_current_year),draw_rowChart(t,"global_system_row_chart","Global System","#3282bf",selectedCountry,updated_current_year),draw_rowChart(t,"public_spirited_row_chart","Public Spirited","#027f71",selectedCountry,updated_current_year),draw_rowChart(t,"global_row_chart","sum of ranks","#796d94",selectedCountry,updated_current_year);var e=d3.select(".countryRect.active").attr("href");updateBarChart(e),draw_sidebar_stats(t.filter(function(t){if(t.Country===e&&t.Year===updated_current_year)return t})[0],updated_current_year)})})}function draw_sidebar_stats(t,e){console.log(t),console.log(t.Rank),d3.selectAll("#rank_text").html("<h4>"+t.Rank+'</h4><p>Rank <span id = "current_year">'+e+"</span></p>"),d3.selectAll("#position_change_text").html(function(){return"Higher rank"===t["Rank change (string)"]?"<h4>"+t["Rank change"]+'</h4><p>Change <span id = "current_year">'+e+"</span></p>":(t["Rank change (string)"],"<h4>"+t["Rank change"]+'</h4><p>Change  <span id = "current_year">'+e+"</span></p>")})}function update_country_text(e){"global"===e?(document.getElementById("countryBarText").innerHTML="Understanding the index",document.getElementById("aboutsidebarText").innerHTML="<p>The Principled Aid Index scores donors across three equally-weighted dimensions:</p><br><p><div class='legend_rect' id ='needs'></div><b>Development gaps</b>: Aid is allocated to address critical development vulnerabilities and inequalities</p></div><p><div class='legend_rect' id ='global_system'></div><b>Global cooperation</b>: Aid is allocated to channels and activities that address shared global challenges</p><p><div class='legend_rect' id ='public_spirited'></div><b>Public spiritedness</b>: Aid is allocated to maximize every opportunity to achieve development impact, with narrower domestic gains an indirect consequence</p><br><h3>Principled Aid Rank <span id=''>"+current_year+"</span></h3>",document.getElementById("countryText").innerHTML="<p></p>"):d3.csv(textDataset,function(t){t=t.filter(function(t){return t.Country==e}),document.getElementById("countryBarText").innerHTML=t[0].Country,document.getElementById("countryText").innerHTML=t[0]["Country Profile Text"],$("body").css("min-height",$(".sidebarContent").height()),pym.sendHeight()})}function resize_window(){resize_main_chart(selectedDivID),resize_row_chart("needs_row_chart","Need"),resize_row_chart("global_system_row_chart","Global System"),resize_row_chart("public_spirited_row_chart","Public Spirited"),resize_row_chart("global_row_chart","sum of ranks")}$(document).ready(function(){pym=new pym.Child,main(containerDiv,dataset),update_country_text("global")});var visualisationName=document.getElementsByTagName("DIV")[0].getAttribute("class"),divClass=".DMA_datavis",indicatorsDict={"X Z-score Solidarity":["poorestCountriesCheck","humanitarianCheck","peacekeepingPersonnelCheck"],"X Z-score Solidarity - A+B":["poorestCountriesCheck","humanitarianCheck"],"X Z-score Solidarity - A+C":["poorestCountriesCheck","peacekeepingPersonnelCheck"],"X Z-score Solidarity - B+C":["humanitarianCheck","peacekeepingPersonnelCheck"],"X Z-score Solidarity - A":["poorestCountriesCheck"],"X Z-score Solidarity - B":["humanitarianCheck"],"X Z-score Solidarity - C":["peacekeepingPersonnelCheck"],"X Z-score Domestic interest":["tiedAidCheck","tradeAndAidCheck","UNVoteCheck"],"X Z-score Domestic interest - D+E":["tiedAidCheck","tradeAndAidCheck"],"X Z-score Domestic interest - D+F":["tiedAidCheck","UNVoteCheck"],"X Z-score Domestic interest - E+F":["tradeAndAidCheck","UNVoteCheck"],"X Z-score Domestic interest - D":["tiedAidCheck"],"X Z-score Domestic interest - E":["tradeAndAidCheck"],"X Z-score Domestic interest - F":["UNVoteCheck"],"Y Z-score Country engagement":["countryProgrammableAidCheck","useOfCountrySystemsCheck","pureBilateralCheck"],"Y Z-score Country engagement - G+H":["countryProgrammableAidCheck","useOfCountrySystemsCheck"],"Y Z-score Country engagement - G+I":["countryProgrammableAidCheck","pureBilateralCheck"],"Y Z-score Country engagement - H+I":["useOfCountrySystemsCheck","pureBilateralCheck"],"Y Z-score Country engagement - G":["countryProgrammableAidCheck"],"Y Z-score Country engagement - H":["useOfCountrySystemsCheck"],"Y Z-score Country engagement - I":["pureBilateralCheck"],"Y Z-score Global engagement":["treatiesAndConventionsCheck","coreMultilateralContributionsCheck","greenClimateFundCheck"],"Y Z-score Global engagement - J+K":["treatiesAndConventionsCheck","coreMultilateralContributionsCheck"],"Y Z-score Global engagement - J+L":["treatiesAndConventionsCheck","greenClimateFundCheck"],"Y Z-score Global engagement - K+L":["coreMultilateralContributionsCheck","greenClimateFundCheck"],"Y Z-score Global engagement - J":["treatiesAndConventionsCheck"],"Y Z-score Global engagement - K":["coreMultilateralContributionsCheck"],"Y Z-score Global engagement - L":["greenClimateFundCheck"]};console.log(indicatorsDict);var selected_column_sample_1=_.invert(indicatorsDict)[["treatiesAndConventionsCheck","greenClimateFundCheck"]];console.log(selected_column_sample_1);var selected_column_sample_2=_.invert(indicatorsDict)[["UNVoteCheck"]];console.log(selected_column_sample_2),console.log("grid_vis.js loaded");
